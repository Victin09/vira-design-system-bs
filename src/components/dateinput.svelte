<vds-pane gap>
  <vds-value grow="1" placeholder={placeholder}></vds-value>
  <vds-icon name="calendar-outline" move="0 (1x / -4)"></vds-icon>
</vds-pane>
<vds-popup width="18 min-content" padding>
  <vds-datepicker
    value={value}
    link-value
    mode={mode}
    begin={begin}
    end={end}
    on:input={handleInput}></vds-datepicker>
</vds-popup>

<script>
import { createEventDispatcher } from 'svelte';
import { startOfDay } from 'date-fns';

export let placeholder;
export let mode;
export let value;
export let begin;
export let end;
export let host;

const dispatch = createEventDispatcher();

$: isRange = mode === 'range';
$: host.setAttribute('type', isRange ? 'daterange' : 'date');

let fromDate = value && startOfDay(Array.isArray(value) ? value[0] : new Date(String(value).split('|')[0]));
let toDate = value && startOfDay(Array.isArray(value)
  ? (value[1] || value[0])
  : new Date(String(value).split('|')[1] || String(value).split('|')[0]));

function handleInput(event) {
  const detail = event.detail;

  if (isRange) {
    fromDate = detail[0];
    toDate = detail[1];
  } else {
    fromDate = toDate = detail;
  }
}

</script>
