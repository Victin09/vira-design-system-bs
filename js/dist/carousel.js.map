{"version":3,"file":"carousel.js","sources":["../src/carousel.js"],"sourcesContent":["/**\n * --------------------------------------------------------------------------\n * Vira Design System (v1.0.0): carousel.js\n * Licensed under MIT (https://github.com/Victin09/vira-design-system/blob/main/LICENSE)\n * --------------------------------------------------------------------------\n */\n\nimport {\n  defineJQueryPlugin,\n  getElementFromSelector,\n  getNextActiveElement,\n  isRTL,\n  isVisible,\n  reflow,\n  triggerTransitionEnd\n} from './util/index'\nimport EventHandler from './dom/event-handler'\nimport Manipulator from './dom/manipulator'\nimport SelectorEngine from './dom/selector-engine'\nimport Swipe from './util/swipe'\nimport BaseComponent from './base-component'\n\n/**\n * Constants\n */\n\nconst NAME = 'carousel'\nconst DATA_KEY = 'vds.carousel'\nconst EVENT_KEY = `.${DATA_KEY}`\nconst DATA_API_KEY = '.data-api'\n\nconst ARROW_LEFT_KEY = 'ArrowLeft'\nconst ARROW_RIGHT_KEY = 'ArrowRight'\nconst TOUCHEVENT_COMPAT_WAIT = 500 // Time for mouse compat events to fire after touch\n\nconst ORDER_NEXT = 'next'\nconst ORDER_PREV = 'prev'\nconst DIRECTION_LEFT = 'left'\nconst DIRECTION_RIGHT = 'right'\n\nconst EVENT_SLIDE = `slide${EVENT_KEY}`\nconst EVENT_SLID = `slid${EVENT_KEY}`\nconst EVENT_KEYDOWN = `keydown${EVENT_KEY}`\nconst EVENT_MOUSEENTER = `mouseenter${EVENT_KEY}`\nconst EVENT_MOUSELEAVE = `mouseleave${EVENT_KEY}`\nconst EVENT_DRAG_START = `dragstart${EVENT_KEY}`\nconst EVENT_LOAD_DATA_API = `load${EVENT_KEY}${DATA_API_KEY}`\nconst EVENT_CLICK_DATA_API = `click${EVENT_KEY}${DATA_API_KEY}`\n\nconst CLASS_NAME_CAROUSEL = 'carousel'\nconst CLASS_NAME_ACTIVE = 'active'\nconst CLASS_NAME_SLIDE = 'slide'\nconst CLASS_NAME_END = 'carousel-item-end'\nconst CLASS_NAME_START = 'carousel-item-start'\nconst CLASS_NAME_NEXT = 'carousel-item-next'\nconst CLASS_NAME_PREV = 'carousel-item-prev'\n\nconst SELECTOR_ACTIVE = '.active'\nconst SELECTOR_ITEM = '.carousel-item'\nconst SELECTOR_ACTIVE_ITEM = SELECTOR_ACTIVE + SELECTOR_ITEM\nconst SELECTOR_ITEM_IMG = '.carousel-item img'\nconst SELECTOR_INDICATORS = '.carousel-indicators'\nconst SELECTOR_DATA_SLIDE = '[data-vds-slide], [data-vds-slide-to]'\nconst SELECTOR_DATA_RIDE = '[data-vds-ride=\"carousel\"]'\n\nconst KEY_TO_DIRECTION = {\n  [ARROW_LEFT_KEY]: DIRECTION_RIGHT,\n  [ARROW_RIGHT_KEY]: DIRECTION_LEFT\n}\n\nconst Default = {\n  interval: 5000,\n  keyboard: true,\n  slide: false,\n  pause: 'hover',\n  wrap: true,\n  touch: true\n}\n\nconst DefaultType = {\n  interval: '(number|boolean)',\n  keyboard: 'boolean',\n  slide: '(boolean|string)',\n  pause: '(string|boolean)',\n  wrap: 'boolean',\n  touch: 'boolean'\n}\n\n/**\n * Class definition\n */\n\nclass Carousel extends BaseComponent {\n  constructor(element, config) {\n    super(element, config)\n\n    this._interval = null\n    this._activeElement = null\n    this._stayPaused = false\n    this._isSliding = false\n    this.touchTimeout = null\n    this._swipeHelper = null\n\n    this._indicatorsElement = SelectorEngine.findOne(SELECTOR_INDICATORS, this._element)\n    this._addEventListeners()\n  }\n\n  // Getters\n  static get Default() {\n    return Default\n  }\n\n  static get DefaultType() {\n    return DefaultType\n  }\n\n  static get NAME() {\n    return NAME\n  }\n\n  // Public\n  next() {\n    this._slide(ORDER_NEXT)\n  }\n\n  nextWhenVisible() {\n    // FIXME TODO use `document.visibilityState`\n    // Don't call next when the page isn't visible\n    // or the carousel or its parent isn't visible\n    if (!document.hidden && isVisible(this._element)) {\n      this.next()\n    }\n  }\n\n  prev() {\n    this._slide(ORDER_PREV)\n  }\n\n  pause(event) {\n    if (!event) {\n      this._stayPaused = true\n    }\n\n    if (this._isSliding) {\n      triggerTransitionEnd(this._element)\n      this.cycle(true)\n    }\n\n    this._clearInterval()\n  }\n\n  cycle(event) {\n    if (!event) {\n      this._stayPaused = false\n    }\n\n    this._clearInterval()\n    if (this._config.interval && !this._stayPaused) {\n      this._updateInterval()\n\n      this._interval = setInterval(() => this.nextWhenVisible(), this._config.interval)\n    }\n  }\n\n  to(index) {\n    const items = this._getItems()\n    if (index > items.length - 1 || index < 0) {\n      return\n    }\n\n    if (this._isSliding) {\n      EventHandler.one(this._element, EVENT_SLID, () => this.to(index))\n      return\n    }\n\n    const activeIndex = this._getItemIndex(this._getActive())\n    if (activeIndex === index) {\n      this.pause()\n      this.cycle()\n      return\n    }\n\n    const order = index > activeIndex ? ORDER_NEXT : ORDER_PREV\n\n    this._slide(order, items[index])\n  }\n\n  dispose() {\n    if (this._swipeHelper) {\n      this._swipeHelper.dispose()\n    }\n\n    super.dispose()\n  }\n\n  // Private\n  _configAfterMerge(config) {\n    config.defaultInterval = config.interval\n    return config\n  }\n\n  _addEventListeners() {\n    if (this._config.keyboard) {\n      EventHandler.on(this._element, EVENT_KEYDOWN, event => this._keydown(event))\n    }\n\n    if (this._config.pause === 'hover') {\n      EventHandler.on(this._element, EVENT_MOUSEENTER, event => this.pause(event))\n      EventHandler.on(this._element, EVENT_MOUSELEAVE, event => this.cycle(event))\n    }\n\n    if (this._config.touch && Swipe.isSupported()) {\n      this._addTouchEventListeners()\n    }\n  }\n\n  _addTouchEventListeners() {\n    for (const img of SelectorEngine.find(SELECTOR_ITEM_IMG, this._element)) {\n      EventHandler.on(img, EVENT_DRAG_START, event => event.preventDefault())\n    }\n\n    const endCallBack = () => {\n      if (this._config.pause !== 'hover') {\n        return\n      }\n\n      // If it's a touch-enabled device, mouseenter/leave are fired as\n      // part of the mouse compatibility events on first tap - the carousel\n      // would stop cycling until user tapped out of it;\n      // here, we listen for touchend, explicitly pause the carousel\n      // (as if it's the second time we tap on it, mouseenter compat event\n      // is NOT fired) and after a timeout (to allow for mouse compatibility\n      // events to fire) we explicitly restart cycling\n\n      this.pause()\n      if (this.touchTimeout) {\n        clearTimeout(this.touchTimeout)\n      }\n\n      this.touchTimeout = setTimeout(event => this.cycle(event), TOUCHEVENT_COMPAT_WAIT + this._config.interval)\n    }\n\n    const swipeConfig = {\n      leftCallback: () => this._slide(this._directionToOrder(DIRECTION_LEFT)),\n      rightCallback: () => this._slide(this._directionToOrder(DIRECTION_RIGHT)),\n      endCallback: endCallBack\n    }\n\n    this._swipeHelper = new Swipe(this._element, swipeConfig)\n  }\n\n  _keydown(event) {\n    if (/input|textarea/i.test(event.target.tagName)) {\n      return\n    }\n\n    const direction = KEY_TO_DIRECTION[event.key]\n    if (direction) {\n      event.preventDefault()\n      this._slide(this._directionToOrder(direction))\n    }\n  }\n\n  _getItemIndex(element) {\n    return this._getItems().indexOf(element)\n  }\n\n  _setActiveIndicatorElement(index) {\n    if (!this._indicatorsElement) {\n      return\n    }\n\n    const activeIndicator = SelectorEngine.findOne(SELECTOR_ACTIVE, this._indicatorsElement)\n\n    activeIndicator.classList.remove(CLASS_NAME_ACTIVE)\n    activeIndicator.removeAttribute('aria-current')\n\n    const newActiveIndicator = SelectorEngine.findOne(`[data-vds-slide-to=\"${index}\"]`, this._indicatorsElement)\n\n    if (newActiveIndicator) {\n      newActiveIndicator.classList.add(CLASS_NAME_ACTIVE)\n      newActiveIndicator.setAttribute('aria-current', 'true')\n    }\n  }\n\n  _updateInterval() {\n    const element = this._activeElement || this._getActive()\n\n    if (!element) {\n      return\n    }\n\n    const elementInterval = Number.parseInt(element.getAttribute('data-vds-interval'), 10)\n\n    this._config.interval = elementInterval || this._config.defaultInterval\n  }\n\n  _slide(order, element = null) {\n    if (this._isSliding) {\n      return\n    }\n\n    const activeElement = this._getActive()\n    const isNext = order === ORDER_NEXT\n    const nextElement = element || getNextActiveElement(this._getItems(), activeElement, isNext, this._config.wrap)\n\n    if (nextElement === activeElement) {\n      return\n    }\n\n    const nextElementIndex = this._getItemIndex(nextElement)\n\n    const triggerEvent = eventName => {\n      return EventHandler.trigger(this._element, eventName, {\n        relatedTarget: nextElement,\n        direction: this._orderToDirection(order),\n        from: this._getItemIndex(activeElement),\n        to: nextElementIndex\n      })\n    }\n\n    const slideEvent = triggerEvent(EVENT_SLIDE)\n\n    if (slideEvent.defaultPrevented) {\n      return\n    }\n\n    if (!activeElement || !nextElement) {\n      // Some weirdness is happening, so we bail\n      // todo: change tests that use empty divs to avoid this check\n      return\n    }\n\n    this._isSliding = true\n\n    const isCycling = Boolean(this._interval)\n    if (isCycling) {\n      this.pause()\n    }\n\n    this._setActiveIndicatorElement(nextElementIndex)\n    this._activeElement = nextElement\n\n    const directionalClassName = isNext ? CLASS_NAME_START : CLASS_NAME_END\n    const orderClassName = isNext ? CLASS_NAME_NEXT : CLASS_NAME_PREV\n\n    nextElement.classList.add(orderClassName)\n\n    reflow(nextElement)\n\n    activeElement.classList.add(directionalClassName)\n    nextElement.classList.add(directionalClassName)\n\n    const completeCallBack = () => {\n      nextElement.classList.remove(directionalClassName, orderClassName)\n      nextElement.classList.add(CLASS_NAME_ACTIVE)\n\n      activeElement.classList.remove(CLASS_NAME_ACTIVE, orderClassName, directionalClassName)\n\n      this._isSliding = false\n\n      triggerEvent(EVENT_SLID)\n    }\n\n    this._queueCallback(completeCallBack, activeElement, this._isAnimated())\n\n    if (isCycling) {\n      this.cycle()\n    }\n  }\n\n  _isAnimated() {\n    return this._element.classList.contains(CLASS_NAME_SLIDE)\n  }\n\n  _getActive() {\n    return SelectorEngine.findOne(SELECTOR_ACTIVE_ITEM, this._element)\n  }\n\n  _getItems() {\n    return SelectorEngine.find(SELECTOR_ITEM, this._element)\n  }\n\n  _clearInterval() {\n    if (this._interval) {\n      clearInterval(this._interval)\n      this._interval = null\n    }\n  }\n\n  _directionToOrder(direction) {\n    if (isRTL()) {\n      return direction === DIRECTION_LEFT ? ORDER_PREV : ORDER_NEXT\n    }\n\n    return direction === DIRECTION_LEFT ? ORDER_NEXT : ORDER_PREV\n  }\n\n  _orderToDirection(order) {\n    if (isRTL()) {\n      return order === ORDER_PREV ? DIRECTION_LEFT : DIRECTION_RIGHT\n    }\n\n    return order === ORDER_PREV ? DIRECTION_RIGHT : DIRECTION_LEFT\n  }\n\n  // Static\n  static jQueryInterface(config) {\n    return this.each(function () {\n      const data = Carousel.getOrCreateInstance(this, config)\n\n      if (typeof config === 'number') {\n        data.to(config)\n        return\n      }\n\n      if (typeof config === 'string') {\n        if (data[config] === undefined || config.startsWith('_') || config === 'constructor') {\n          throw new TypeError(`No method named \"${config}\"`)\n        }\n\n        data[config]()\n        return\n      }\n\n      if (data._config.interval && data._config.ride) {\n        data.pause()\n        data.cycle()\n      }\n    })\n  }\n}\n\n/**\n * Data API implementation\n */\n\nEventHandler.on(document, EVENT_CLICK_DATA_API, SELECTOR_DATA_SLIDE, function (event) {\n  const target = getElementFromSelector(this)\n\n  if (!target || !target.classList.contains(CLASS_NAME_CAROUSEL)) {\n    return\n  }\n\n  event.preventDefault()\n\n  const carousel = Carousel.getOrCreateInstance(target)\n  const slideIndex = this.getAttribute('data-vds-slide-to')\n\n  if (slideIndex) {\n    carousel.to(slideIndex)\n    return\n  }\n\n  if (Manipulator.getDataAttribute(this, 'slide') === 'next') {\n    carousel.next()\n    return\n  }\n\n  carousel.prev()\n})\n\nEventHandler.on(window, EVENT_LOAD_DATA_API, () => {\n  const carousels = SelectorEngine.find(SELECTOR_DATA_RIDE)\n\n  for (const carousel of carousels) {\n    Carousel.getOrCreateInstance(carousel)\n  }\n})\n\n/**\n * jQuery\n */\n\ndefineJQueryPlugin(Carousel)\n\nexport default Carousel\n"],"names":["NAME","DATA_KEY","EVENT_KEY","DATA_API_KEY","ARROW_LEFT_KEY","ARROW_RIGHT_KEY","TOUCHEVENT_COMPAT_WAIT","ORDER_NEXT","ORDER_PREV","DIRECTION_LEFT","DIRECTION_RIGHT","EVENT_SLIDE","EVENT_SLID","EVENT_KEYDOWN","EVENT_MOUSEENTER","EVENT_MOUSELEAVE","EVENT_DRAG_START","EVENT_LOAD_DATA_API","EVENT_CLICK_DATA_API","CLASS_NAME_CAROUSEL","CLASS_NAME_ACTIVE","CLASS_NAME_SLIDE","CLASS_NAME_END","CLASS_NAME_START","CLASS_NAME_NEXT","CLASS_NAME_PREV","SELECTOR_ACTIVE","SELECTOR_ITEM","SELECTOR_ACTIVE_ITEM","SELECTOR_ITEM_IMG","SELECTOR_INDICATORS","SELECTOR_DATA_SLIDE","SELECTOR_DATA_RIDE","KEY_TO_DIRECTION","Default","interval","keyboard","slide","pause","wrap","touch","DefaultType","Carousel","BaseComponent","constructor","element","config","_interval","_activeElement","_stayPaused","_isSliding","touchTimeout","_swipeHelper","_indicatorsElement","SelectorEngine","findOne","_element","_addEventListeners","next","_slide","nextWhenVisible","document","hidden","isVisible","prev","event","triggerTransitionEnd","cycle","_clearInterval","_config","_updateInterval","setInterval","to","index","items","_getItems","length","EventHandler","one","activeIndex","_getItemIndex","_getActive","order","dispose","_configAfterMerge","defaultInterval","on","_keydown","Swipe","isSupported","_addTouchEventListeners","img","find","preventDefault","endCallBack","clearTimeout","setTimeout","swipeConfig","leftCallback","_directionToOrder","rightCallback","endCallback","test","target","tagName","direction","key","indexOf","_setActiveIndicatorElement","activeIndicator","classList","remove","removeAttribute","newActiveIndicator","add","setAttribute","elementInterval","Number","parseInt","getAttribute","activeElement","isNext","nextElement","getNextActiveElement","nextElementIndex","triggerEvent","eventName","trigger","relatedTarget","_orderToDirection","from","slideEvent","defaultPrevented","isCycling","Boolean","directionalClassName","orderClassName","reflow","completeCallBack","_queueCallback","_isAnimated","contains","clearInterval","isRTL","jQueryInterface","each","data","getOrCreateInstance","undefined","startsWith","TypeError","ride","getElementFromSelector","carousel","slideIndex","Manipulator","getDataAttribute","window","carousels","defineJQueryPlugin"],"mappings":"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"}